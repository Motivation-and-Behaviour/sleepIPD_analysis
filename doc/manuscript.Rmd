---
title             : "The title"
shorttitle        : "Title"

author: 
  - name          : "First Author"
    affiliation   : "1"
    corresponding : yes    # Define only one corresponding author
    address       : "Postal address"
    email         : "my@email.com"
    role:         # Contributorship roles (e.g., CRediT, https://casrai.org/credit/)
      - "Conceptualization"
      - "Writing - Original Draft Preparation"
      - "Writing - Review & Editing"
  - name          : "Ernst-August Doelle"
    affiliation   : "1,2"
    role:
      - "Writing - Review & Editing"
      - "Supervision"

affiliation:
  - id            : "1"
    institution   : "Wilhelm-Wundt-University"
  - id            : "2"
    institution   : "Konstanz Business School"

authornote: |
  Add complete departmental affiliations for each author here. Each new line herein must be indented, like this line.

  Enter author note here.

abstract: |
  One or two sentences providing a **basic introduction** to the field,  comprehensible to a scientist in any discipline.
  
  <!-- https://tinyurl.com/ybremelq -->
  
keywords          : "keywords"
wordcount         : "X"


floatsintext      : no
linenumbers       : yes
draft             : no
mask              : no

figurelist        : no
tablelist         : no
footnotelist      : no

classoption       : "man"
output            : papaja::apa6_pdf
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
source("R/utils.R")
options(warn = -1)
```

```{r load-libraries}
library(targets)
library(gt)
require(ggplot2)
library(papaja)
```

```{r load-targets, include=FALSE}
tar_load(model_list)
tar_load(data_clean)
pretty <- function(x) format(x, big.mark = ",")
```

# Results

The aggregated data-set describes `r nrow(data_clean) |> pretty()` observations of daily physical activity and sleep from `r length(unique(data_clean$participant_id)) |> pretty()` unique participants. Table \@ref(demo) shows demographic information. A table of study characteristics can be found in supplementary materials.

## The effects of physical activity volume on sleep

We explored the effects of physical activity on sleep (RQ1) using mixed-effects models. We estimated the effect of physical activity volume on sleep by age, and the results are presented in Table \@ref(tab:sleep-by-volume) and Figure \@ref(fig:sleep-by-volume-fig). There was no meaningful relationship between physical activity volume and sleep duration. However, a positive curvilinear relationship was observed between physical activity volume and sleep efficiency, onset, and regularity, which interacted with age. Sleep efficiency improved with greater physical activity volume, but improvements tapered off for older individuals. Physical activity volume and sleep onset had a positive association for younger individuals, but a negative association for older individuals, where sleep onset was reduced among those with the highest physical activity. There was a strong positive association between physical activity volume and sleep regularity, which was strongest among older participants. For participants aged 35 years and above, this link weakened among those with a physical activity volume greater than two standard deviations.

\renewcommand{\arraystretch}{0.8}

```{r sleep-by-exercise}
note <- "Adjusted for SES, BMI, and sex. "

format_table <- function(tab){
  tab$term <- gsub("I\\(","", tab$term) |> 
    gsub("_", " ", x = _) |> 
    gsub("\\^2\\)","$^2$", x = _)
  tab
}

sleep_names <- c("scale_sleep_duration by scale_pa_volume", "scale_sleep_efficiency by scale_pa_volume", 
"scale_sleep_onset by scale_pa_volume", "scale_sleep_regularity by scale_pa_volume")

sleep_outcomes <- lapply(model_list[sleep_names], function(x){
tab <- format_table(x$table)  
# Remove BMI, sex and ses from table
tab <- tab[!grepl("^ses", tab$term),]
tab <- tab[!grepl("^sex", tab$term),]
tab <- tab[!grepl("^bmi", tab$term),]
tab$term <- gsub("\\bpa\\b", " PA ", tab$term)
tab$term <- stringr::str_to_sentence(tab$term)
names(tab) <- c("Term", "$\\beta$ [95\\% CI]", "SE", "t", "p")
tab
})
names(sleep_outcomes) <- gsub("scale_", "", names(sleep_outcomes)) |> 
  gsub("\\sby.*", "", x = _ ) |> 
  gsub("_", " ", x = _ ) |> 
  stringr::str_to_sentence()

  papaja::apa_table(sleep_outcomes,
                    caption = "Sleep on physical activity volume controlling for SES, gender and BMI",
                    note = note,
                    escape = FALSE)
```

```{r sleep-by-volume-fig, fig.cap = "Sleep metrics on Physical activity volume"}
knitr::include_graphics(here::here("Figures/sleep on pa_volume.jpg"), error = FALSE)


```

